{% extends 'main/main.html' %}
{% load static %}

{% block title %}
    Найти инициативу
{% endblock %}

{% block content %}
    <main>
        <section>
            <div class="header_bg"></div>
            <div class="container-fluid">
               <div class="row">
                    <div class="search_bg">
                        <div class="title_search container">
                            <ul class="search_ul">
                                <li class="col-9"><p>Найти свою инициативу</p></li>
                                <li class="col-2"><img src="{% static 'img/select_town.svg' %}" alt=""></li>
                            </ul>
                        </div>
                    </div>
               </div>
            </div>
      </section>
        <section class="container-fluid">
          <div class="row">
              <div class="search_content">
              <div class="leftbar col-3">
                  <div class="serch_int col-12">
                      <input class="col-8 btn" type="text" placeholder="Поиск">
                      <div class="serch_img col-2">
                          <a href="" type="submit">
                              <img  src="{% static 'img/search_img111.svg' %}" alt="">
                          </a>
                      </div>
                  </div>
                  <div class="category col-12">
                      <div class="category_title col-12">
                          <p>Категории</p>
                      </div>
                      <div class="category_ul_block">
                          <ul class="category_ul">
                              <li><a href="">Здравохранение</a></li>
                              <li><a href="">Дом и двор</a></li>
                              <li><a href="">Окружающая среда</a></li>
                              <li><a href="">Пушистые друзья</a></li>
                              <li><a href="">Образование</a></li>
                              <li><a href="">Культурное наледие</a></li>
                              <li><a href="">Экономика</a></li>
                          </ul>
                      </div>
                  </div>
              </div>
                   <div class="graph col-9">
                     <div id = "mynetwork"></div>
<div id="loadingBar">
    <div class="outerBorder">
        <div id="text">0%</div>
        <div id="border">
            <div id="bar"></div>
        </div>
    </div>
</div>
        <script type="text/javascript">

        // initialize global variables.
        var edges;
        var nodes;
        var network;
        var container;
        var options, data;


        // This method is responsible for drawing the graph, returns the drawn network
        function drawGraph() {
            var container = document.getElementById('mynetwork');



            // parsing and collecting nodes and edges from the python
            nodes = new vis.DataSet({{ nodes|safe }});
            edges = new vis.DataSet({{ edges|safe }});
            // adding nodes and edges to the graph
            data = {nodes: nodes, edges: edges};

            var options = {
        "configure": {
            "enabled": false
        },
        "edges": {
            "color": {
                "inherit": true
            },
            "smooth": {
                "enabled": false,
                "type": "continuous"
            }
        },
        "interaction": {
            "dragNodes": true,
            "hideEdgesOnDrag": false,
            "hideNodesOnDrag": false
        },
        "physics": {
            "barnesHut": {
                "avoidOverlap": 0,
                "centralGravity": 0.3,
                "damping": 0.09,
                "gravitationalConstant": -80000,
                "springConstant": 0.001,
                "springLength": 250
            },
            "enabled": true,
            "stabilization": {
                "enabled": true,
                "fit": true,
                "iterations": 1000,
                "onlyDynamicEdges": false,
                "updateInterval": 50
            }
        }
        };





            network = new vis.Network(container, data, options);





            network.on("stabilizationProgress", function(params) {
                document.getElementById('loadingBar').removeAttribute("style");
                var maxWidth = 496;
                var minWidth = 20;
                var widthFactor = params.iterations/params.total;
                var width = Math.max(minWidth,maxWidth * widthFactor);

                document.getElementById('bar').style.width = width + 'px';
                document.getElementById('text').innerHTML = Math.round(widthFactor*100) + '%';
            });
            network.once("stabilizationIterationsDone", function() {
                document.getElementById('text').innerHTML = '100%';
                document.getElementById('bar').style.width = '496px';
                document.getElementById('loadingBar').style.opacity = 0;
                // really clean the dom element
                setTimeout(function () {document.getElementById('loadingBar').style.display = 'none';}, 500);
            });


            return network;

        }

        drawGraph();

        </script>
                    </div>
              </div>
          </div>
      </section>
    </main>
{% endblock %}
